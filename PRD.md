# PRD - 产品需求文档
# Earthlord: 末世开拓者

**文档版本**: v1.0
**创建日期**: 2025年12月
**产品类型**: LBS位置服务游戏
**平台**: iOS (App Store)

---

## 1. 产品概述

### 1.1 产品定位

Earthlord（末世开拓者）是一款基于真实地理位置的末世生存类手机游戏。通过"Walk to Earn"机制，玩家在现实世界中行走、探索真实地标、圈占领地、收集资源、建造家园,并与其他玩家交易互动。

### 1.2 核心价值主张

- **现实与虚拟结合**: 将玩家的真实行走转化为游戏内价值
- **健康生活方式**: 鼓励用户走出门户外运动
- **社交互动**: 基于位置的玩家协作与竞争
- **商业变现**: 订阅制+内购的成熟商业模式

### 1.3 世界观设定

**时间线:**
- 2048年: "终末战争"爆发,全球文明在72小时内崩塌,99%人口消失
- 2051年: 幸存者从废墟中走出,《新开拓者协议》颁布

**核心法则:**
> "凡以双足丈量之无主土地,皆为开拓者所有"

**视觉风格:** "希望朋克" - 废土之上的新生,绝望中的希望

---

## 2. 目标用户

### 2.1 主要用户画像

**画像1: 运动爱好者 (30%)**
- 年龄: 25-40岁
- 特征: 喜欢跑步、骑行等户外运动
- 需求: 让运动变得更有趣,有额外激励
- 参考产品: Keep、咕咚、悦跑圈

**画像2: 游戏玩家 (40%)**
- 年龄: 18-35岁
- 特征: 玩过《宝可梦GO》《Ingress》等LBS游戏
- 需求: 创新玩法、社交互动、收集成就
- 参考产品: 宝可梦GO、Ingress

**画像3: 位置服务探索者 (30%)**
- 年龄: 20-45岁
- 特征: 喜欢探索城市、打卡新地点
- 需求: 发现新地点、记录足迹、社交分享
- 参考产品: 大众点评、小红书

### 2.2 市场规模

- **全球LBS游戏市场**: 宝可梦GO累计收入超60亿美元,日活千万级
- **iOS全球市场**: App Store覆盖175个国家和地区
- **健康生活趋势**: 全球运动健康App市场年增长率20%+

---

## 3. 核心功能需求

### 3.1 游戏核心循环

```
登录注册 → 圈地占领 → 探索搜刮 → 获得资源
    ↑                               ↓
    │         建造建筑 ← 消耗资源 ←─┘
    │         交易换物 ← 流通资源 ←─┘
    │         生存消耗 ← 食物/水 ←──┘
    │                               ↓
    └────── 通讯社交 ← 成就排行 ← 持续发展
```

### 3.2 功能模块清单

#### 第一部分: 登录与圈地系统

**M1. 登录注册系统**
- **需求描述**: 支持多种登录方式,确保用户可以安全快速地创建账号并进入游戏
- **功能要点**:
  - 邮箱注册登录(用户名+密码)
  - Apple ID登录(OAuth)
  - Google账号登录(OAuth)
  - 会话管理和多设备支持
  - 密码找回和邮箱验证
- **技术方案**: Supabase Auth
- **优先级**: P0 (必需)

**M2. GPS圈地系统**
- **需求描述**: 玩家通过在现实世界行走绘制闭合多边形来占领土地
- **功能要点**:
  - 实时GPS定位追踪
  - 轨迹绘制(蓝色线条可视化)
  - 多边形闭合检测(起点终点距离<50米)
  - 作弊检测(速度>8m/s无效)
  - 领地重叠检测(不允许侵占他人领地)
  - 最小面积限制(>500m²)
- **技术方案**: Apple MapKit + Core Location + PostGIS
- **优先级**: P0 (核心玩法)

**M3. 领地管理**
- **需求描述**: 玩家可以查看、命名、管理自己的领地
- **功能要点**:
  - 领地列表查看
  - 领地命名和编辑
  - 面积统计显示
  - 建筑数量统计
  - 交易权限设置(允许/禁止其他玩家在领地内交易)
  - 领地状态管理(活跃/废弃)
- **技术方案**: Supabase + PostGIS
- **优先级**: P0

#### 第二部分: 探索与资源获取

**M4. POI发现与搜刮**
- **需求描述**: 玩家在现实世界移动时,自动发现附近的兴趣点(POI)并可以搜刮获得资源
- **功能要点**:
  - 自动发现附近POI(地理围栏100米)
  - POI分类映射资源类型:
    - 医院/药店 → 药品(急救包、抗生素)
    - 超市/餐厅 → 食物(罐头、饮用水)
    - 工厂/工地 → 金属材料
    - 公园/林地 → 木材
    - 银行/珠宝店 → 稀有材料
  - 搜刮冷却时间(同一POI 24小时只能搜刮一次)
  - 搜刮奖励随机生成(基于POI类型)
  - 探索距离和时长统计
- **技术方案**: Apple MapKit POI API + 地理围栏
- **优先级**: P0 (核心玩法)

**M5. 背包系统**
- **需求描述**: 存储玩家收集的所有物品,支持查看、使用、管理
- **功能要点**:
  - 背包容量限制(默认100格)
  - 物品分类展示(食物、药品、材料、工具)
  - 物品数量显示和堆叠
  - 物品使用功能
  - 物品丢弃功能
  - 背包容量扩展(通过建造仓库)
- **技术方案**: 本地优先架构(SQLite) + 云端同步(Supabase)
- **优先级**: P0

#### 第三部分: 建造与交易系统

**M6. 建造系统**
- **需求描述**: 玩家在自己的领地上建造各类建筑设施
- **功能要点**:
  - 15种建筑类型,分为4大类:
    - 生存类: 篝火(取暖)、庇护所(休息)
    - 储存类: 小仓库、中仓库、大仓库(扩展背包容量)
    - 生产类: 农田、工作台、加工厂(生产资源)
    - 能源类: 太阳能板、风力发电机(提供能源)
  - 建造资源消耗验证
  - 建筑位置选择(在领地内拖拽放置)
  - 建造时间机制
  - 建筑数量限制(按领地面积)
- **技术方案**: 配置表驱动 + 资源验证系统
- **优先级**: P0

**M7. 建筑状态管理**
- **需求描述**: 建筑有不同的状态,支持升级、维修、激活等操作
- **功能要点**:
  - 建筑状态机:
    - 建造中 → 待激活 → 运行中 → 损坏 → 维修中
  - 状态操作:
    - 激活: 消耗资源启动建筑
    - 升级: 提升建筑等级(Tier 1/2/3)
    - 维修: 修复损坏的建筑
    - 拆除: 回收部分资源
  - 建筑等级系统(3个等级,每级属性提升)
- **技术方案**: 状态机模式
- **优先级**: P1

**M8. 交易系统**
- **需求描述**: 玩家之间可以进行物品交易(以物易物)
- **功能要点**:
  - 发布交易挂单:
    - 选择"我提供"的物品和数量
    - 选择"我需要"的物品和数量
  - 基于位置的交易发现:
    - 只能看到进入范围100米内玩家的挂单
    - 需要对方开启"允许交易"权限
  - 交易执行:
    - 资源验证(双方背包容量和物品数量)
    - 原子性交换(要么全部成功,要么全部失败)
  - 交易历史记录
- **技术方案**: 地理围栏 + 事务性资源交换
- **优先级**: P1

#### 第四部分: 通讯系统

**M9. 消息中心**
- **需求描述**: 接收系统消息、公告、任务等通知
- **功能要点**:
  - 官方消息分类:
    - 生存指南(新手教程)
    - 每日任务
    - 系统公告
    - 活动通知
  - 消息已读/未读状态
  - 消息推送通知
- **技术方案**: Supabase + Push Notification
- **优先级**: P1

**M10. 公共频道聊天**
- **需求描述**: 基于位置的实时公共聊天室
- **功能要点**:
  - 覆盖范围显示(默认3km)
  - 实时消息收发(秒级延迟)
  - 消息记录(保留最近100条)
  - 位置更新时自动切换频道
  - 发送者信息展示(昵称、距离)
- **技术方案**: Supabase Realtime + 地理位置过滤
- **优先级**: P1

**M11. 频道管理**
- **需求描述**: 创建和加入自定义频道(类似群组)
- **功能要点**:
  - 创建频道(命名、描述、公开/私密)
  - 浏览附近频道列表(显示距离和在线人数)
  - 加入/退出频道
  - 频道内聊天
  - 频道成员管理(创建者权限)
- **技术方案**: Supabase + 群组系统
- **优先级**: P2

**M12. PTT呼叫**
- **需求描述**: 模拟真实对讲机的Push-to-Talk语音功能
- **功能要点**:
  - 长按发送语音消息
  - 频率选择(公共频道/私人频道)
  - 语音消息播放
  - 呼叫范围限制(根据设备等级)
- **技术方案**: AVFoundation + 音频压缩
- **优先级**: P2

**M13. 通讯设备等级**
- **需求描述**: 通讯能力的等级限制和升级系统
- **功能要点**:
  - 设备等级体系:
    - 收音机(L1): 只能接收,不能发送
    - 对讲机(L2): 3km范围收发
    - 营地电台(L3): 10km范围
    - 卫星通讯(L4): 全球范围
  - 设备升级消耗资源
  - 根据设备等级限制功能
- **技术方案**: 配置表 + 权限验证
- **优先级**: P2 (付费点)

#### 第五部分: 个人中心与商业化

**M14. 个人主页**
- **需求描述**: 展示玩家的游戏数据和成就
- **功能要点**:
  - 基础信息: 昵称、头像、等级
  - 生存统计: 存活天数、开拓天数
  - 领地统计: 领地数量、总面积
  - 建筑统计: 建筑数量、最高等级
  - 探索统计: 探索POI数量、总距离
- **技术方案**: Supabase 聚合查询
- **优先级**: P0

**M15. 多语言设置**
- **需求描述**: 支持多语言切换,便于全球化
- **功能要点**:
  - 支持语言: 简体中文、繁体中文、英文
  - 语言切换后重启应用
  - 所有UI文本国际化
- **技术方案**: SwiftUI Localizable.strings
- **优先级**: P1 (出海必需)

**M16. 付费订阅系统**
- **需求描述**: 商业变现核心,提供订阅和内购
- **功能要点**:
  - 订阅产品:
    - 开拓者月卡($9.99/月): 无限探索、范围扩大
    - 领主通行证($19.99/月): 全部特权
  - 一次性购买:
    - 初级物资包($0.99)
    - 中级物资包($2.99)
    - 高级物资包($4.99)
    - 稀有资源包($9.99)
  - 购买验证和发货
  - 订阅自动续费管理
- **技术方案**: StoreKit 2
- **优先级**: P0 (变现核心)

**M17. 排行榜**
- **需求描述**: 全球玩家竞争排名
- **功能要点**:
  - 三个榜单:
    - 领地面积榜(按总面积排名)
    - 探索废墟榜(按POI搜刮次数排名)
    - 建筑数量榜(按建筑总数排名)
  - 显示个人排名和周边排名
  - 每5分钟更新一次
- **技术方案**: Supabase 窗口函数 + 缓存
- **优先级**: P1

**M18. 成就系统**
- **需求描述**: 引导新手、激励长期游玩
- **功能要点**:
  - 成就分类:
    - 新手成就: 第一次圈地、第一次搜刮、第一次建造
    - 进阶成就: 圈地10次、探索100个POI、建造50个建筑
    - 稀有成就: 领地面积超10万m²、建造全部建筑类型
  - 成就完成奖励(金币、资源)
  - 成就进度追踪
  - 成就徽章展示
- **技术方案**: EventBus + 发布-订阅模式
- **优先级**: P1

**M19. 生存体征**
- **需求描述**: 生存游戏的核心机制,增加紧迫感
- **功能要点**:
  - 三大体征:
    - 核心生命(0-100): 归零则游戏结束
    - 饱食度(0-100%): 每小时-5,低于20掉血
    - 水分(0-100%): 每小时-10,低于20掉血
  - 增益机制: 饱食度和水分>80%获得额外收益
  - 使用物品恢复体征:
    - 罐头食品: +30饱食度
    - 饮用水: +40水分
    - 急救包: +50生命值
  - 时间衰减(后台运行时也计算)
- **技术方案**: 定时器 + 后台计算
- **优先级**: P2

---

## 4. 技术需求

### 4.1 技术栈

| 技术领域 | 技术选型 | 理由 |
|---------|---------|------|
| 开发平台 | iOS (Swift + SwiftUI) | App Store全球化,175国市场 |
| 地图服务 | Apple MapKit | 免费无限次调用,全球可用 |
| 定位服务 | Core Location | iOS原生,精度高 |
| 后端服务 | Supabase | 免费额度大,自带Auth/Realtime/存储 |
| 数据库 | PostgreSQL + PostGIS | 支持地理空间查询 |
| 支付系统 | StoreKit 2 | 苹果官方,安全可靠 |
| 本地存储 | SQLite + Core Data | 本地优先架构 |
| 实时通信 | Supabase Realtime | WebSocket,低延迟 |
| 音频处理 | AVFoundation | PTT语音功能 |

### 4.2 非功能性需求

**性能要求:**
- GPS定位精度: ≤10米
- 地图加载时间: ≤2秒
- 消息送达延迟: ≤1秒
- 支持10万+并发用户
- 本地数据库查询: ≤100ms

**安全要求:**
- 用户密码加密存储
- OAuth令牌安全管理
- 防作弊机制(GPS速度检测)
- 交易原子性保证
- 数据传输HTTPS加密

**兼容性:**
- iOS 17.0+
- iPhone X及以上机型
- 支持深色模式
- 支持横竖屏切换

**可用性:**
- 无网络时可查看本地数据
- 网络恢复后自动同步
- 后台运行支持(定位、体征计算)
- 低电量模式优化

---

## 5. 商业模式

### 5.1 变现方式

**1. 订阅收入 (主要)**
- 开拓者月卡: $9.99/月
- 领主通行证: $19.99/月
- 目标转化率: 3-5%

**2. 内购道具 (辅助)**
- 资源包: $0.99-$9.99
- 通讯设备升级
- 背包扩容
- 预期ARPU: $3-5/月

**3. 广告收入 (可选)**
- 观看广告获得资源
- 不影响核心体验

### 5.2 收入预测

假设用户规模:
- 注册用户: 10万
- 月活用户(MAU): 3万 (30%留存)
- 付费用户: 900人 (3%转化率)
- 月收入: $9,000 - $18,000
- 年收入: $108,000 - $216,000

### 5.3 成本估算

- Supabase: $25/月 (付费版,1万MAU以内)
- Apple Developer: $99/年
- AI辅助开发: 已完成,无额外成本
- **总成本**: ~$400/年

**净利润率**: 95%+

---

## 6. 成功指标 (KPI)

### 6.1 用户增长指标

- DAU (日活跃用户): 目标1万+
- MAU (月活跃用户): 目标3万+
- 次日留存率: ≥40%
- 7日留存率: ≥25%
- 30日留存率: ≥15%

### 6.2 用户行为指标

- 日均游玩时长: ≥30分钟
- 日均行走距离: ≥2公里
- 日均探索POI数: ≥3个
- 圈地成功率: ≥60%

### 6.3 商业指标

- 付费转化率: ≥3%
- ARPU (平均每用户收入): ≥$3/月
- LTV (用户生命周期价值): ≥$30
- CAC (用户获取成本): ≤$5

### 6.4 社交指标

- 日均聊天消息数: ≥10万条
- 交易成交率: ≥40%
- 频道参与率: ≥20%

---

## 7. 开发计划

### 7.1 版本规划

**v1.0 MVP (最小可行产品) - 已完成**
- 登录注册
- GPS圈地
- POI探索搜刮
- 背包系统
- 基础建造
- 付费系统

**v1.1 社交版本**
- 公共频道
- 频道管理
- 交易系统
- 排行榜

**v1.2 深度版本**
- 成就系统
- 生存体征
- PTT呼叫
- 建筑升级

**v2.0 联盟版本 (规划中)**
- 玩家联盟系统
- 联盟战争
- 联盟领地
- 联盟任务

### 7.2 里程碑

| 阶段 | 时间 | 交付物 |
|-----|------|-------|
| 开发完成 | 已完成 | 48,000行代码 |
| 内测 | Week 1-2 | 邀请50-100用户测试 |
| 优化迭代 | Week 3-4 | 修复bug,优化体验 |
| App Store提审 | Week 5 | 提交审核材料 |
| 正式发布 | Week 6 | 全球175国上架 |
| 运营推广 | Week 7+ | 用户增长,数据分析 |

---

## 8. 风险与挑战

### 8.1 技术风险

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| GPS定位不准 | 高 | 采用苹果原生定位,精度高;增加轨迹平滑算法 |
| 地理数据库性能 | 中 | PostGIS索引优化;缓存热点区域数据 |
| 实时消息延迟 | 中 | Supabase Realtime已验证;备用方案轮询 |
| 电量消耗过高 | 高 | 优化定位频率;后台智能降频 |

### 8.2 产品风险

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| 用户流失率高 | 高 | 成就系统引导;生存体征增加粘性;社交留存 |
| 付费转化率低 | 高 | 免费体验足够好;订阅价值明确;限时优惠 |
| 作弊行为 | 中 | GPS速度检测;轨迹异常识别;人工审核 |
| 隐私问题 | 中 | 隐私政策明确;位置数据加密;用户可控 |

### 8.3 市场风险

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| 竞品打压 | 中 | 差异化定位(末世题材);快速迭代;社区运营 |
| App Store审核 | 中 | 提前准备审核材料;遵守苹果政策 |
| 政策法规 | 低 | 符合各国数据保护法;GDPR合规 |

---

## 9. 竞品分析

### 9.1 直接竞品

**宝可梦GO**
- 优势: 强IP,全球知名度,成熟运营
- 劣势: 玩法固化,创新不足,付费压力大
- 差异化: 我们主打圈地建造+生存体征,更硬核

**Ingress**
- 优势: Niantic原创,玩家忠诚度高
- 劣势: 门槛高,新手不友好,题材小众
- 差异化: 我们世界观更具吸引力,玩法更易上手

### 9.2 间接竞品

**Keep**
- 优势: 国内最大运动App,用户基数大
- 劣势: 游戏化不足,缺乏社交互动
- 差异化: 我们是游戏,不是工具,趣味性更强

**Zombies, Run!**
- 优势: 跑步+剧情,沉浸感强
- 劣势: 单机为主,缺乏多人玩法
- 差异化: 我们多人在线,社交互动更丰富

### 9.3 竞争策略

1. **差异化定位**: 末世生存+圈地建造,市场独特
2. **技术优势**: 苹果MapKit免费,成本更低
3. **快速迭代**: AI辅助开发,更新速度快
4. **社区运营**: 建立玩家社群,提升粘性
5. **全球化**: 多语言+iOS全球市场

---

## 10. 附录

### 10.1 功能与代码文件对照表

| 功能模块 | 核心代码文件 | 代码行数 |
|---------|------------|---------|
| 登录注册 | AuthManager.swift | ~380 |
| GPS圈地 | LocationManager.swift | ~950 |
| 领地管理 | TerritoryManager.swift | ~1,200 |
| POI探索 | POIManager.swift, ExplorationManager.swift | ~1,400 |
| 背包系统 | ItemManager.swift | ~800 |
| 建造系统 | BuildingManager.swift | ~1,500 |
| 交易系统 | TradeManager.swift | ~1,200 |
| 通讯系统 | RadioManager.swift, CommunicationManager.swift, ChannelManager.swift | ~2,800 |
| 个人中心 | ProfileManager.swift | ~500 |
| 支付系统 | StoreKitManager.swift | ~1,000 |
| 排行榜 | LeaderboardManager.swift | ~600 |
| 成就系统 | AchievementManager.swift | ~1,200 |
| 生存体征 | VitalSignsManagerV2.swift | ~800 |
| 其他 | UI、工具类、配置等 | ~33,670 |
| **总计** | | **~48,000行** |

### 10.2 术语表

| 术语 | 英文 | 说明 |
|-----|------|------|
| LBS | Location Based Service | 基于位置的服务 |
| POI | Point of Interest | 兴趣点 |
| Walk to Earn | - | 走路赚取奖励 |
| PTT | Push to Talk | 按下发送语音 |
| GPS | Global Positioning System | 全球定位系统 |
| PostGIS | - | PostgreSQL的地理空间扩展 |
| OAuth | Open Authorization | 开放授权协议 |
| ARPU | Average Revenue Per User | 平均每用户收入 |
| LTV | Lifetime Value | 用户生命周期价值 |
| CAC | Customer Acquisition Cost | 用户获取成本 |

### 10.3 参考资料

- [宝可梦GO收入报告](https://sensortower.com/blog/pokemon-go-revenue-and-downloads)
- [App Store全球市场数据](https://www.apple.com/app-store/)
- [Supabase官方文档](https://supabase.com/docs)
- [Apple MapKit文档](https://developer.apple.com/documentation/mapkit/)
- [StoreKit 2文档](https://developer.apple.com/documentation/storekit)

---

**文档结束**

---

**审批流程:**

| 角色 | 姓名 | 日期 | 签名 |
|-----|------|------|------|
| 产品经理 | | | |
| 技术负责人 | | | |
| 项目经理 | | | |
| CEO | | | |
